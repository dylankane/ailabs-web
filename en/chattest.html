<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Agent Card — Grow Up, Page Grows Down</title>
<style>
  :root{
    --bg:#f8f8f8; --text:#1a1a1a; --muted:#666;
    --accent:#d4a017; --white:#fff; --border:#e6e6e6; --radius:14px;
  }
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }

  /* HERO: normal flow, allowed to grow downward naturally */
  .hero{
    min-height:100svh;           /* mobile-safe viewport */
    display:flex; flex-direction:column; align-items:center;
    gap:3rem;                     /* places card in lower half */
    padding:2rem 1rem;
    box-sizing:border-box;
    overflow:visible;             /* important: allow growth, no clipping */
  }
  .hero-title{max-width:60ch; text-align:center}
  .hero-title h1{margin:.2rem 0; font-size:clamp(2rem,5vw,3rem)}
  .hero-title p{margin:0; color:var(--muted)}

  /* AGENT CARD: bottom edge is its natural place; input pinned to card bottom */
  .agent-card{
    width:min(100%, 720px);
    background:var(--white);
    border:1px solid var(--border);
    border-radius:var(--radius);
    box-shadow:0 6px 20px rgba(0,0,0,.07);
    display:flex;
    flex-direction:column;
    justify-content:flex-end;     /* input stays at card bottom */
    max-height:90svh;             /* cap card height */
    overflow:hidden;              /* thread will scroll inside */
  }

  .agent-thread{
    flex:1 1 auto;
    overflow-y:auto;
    padding:1rem;
    display:flex; flex-direction:column; gap:.75rem;
    scroll-behavior:smooth;
    background:#fff;
  }
  .msg{
    max-width:75%;
    padding:.6rem .9rem; border-radius:12px;
    border:1px solid var(--border); background:#fff;
    word-wrap:break-word;
  }
  .msg.user{
    align-self:flex-end;
    background:var(--accent); border-color:var(--accent); color:#111;
  }

  .agent-form{
    display:flex; align-items:center; gap:.5rem;
    padding:.6rem; border-top:1px solid var(--border); background:#fff;
  }
  .agent-form input{
    flex:1; padding:.7rem .9rem;
    border:1px solid var(--border); border-radius:12px; font-size:1rem; outline:none;
  }
  .agent-form button{
    padding:.7rem 1rem; border:none; border-radius:12px; background:var(--accent); color:#111; cursor:pointer;
  }

  /* extra content below so you can scroll page */
  .below{height:120vh; display:grid; place-items:center; color:#777}
</style>
</head>
<body>
  <section class="hero" id="hero">
    <div class="hero-title">
      <h1>AI Labs — Demo</h1>
      <p>Card starts in the lower half. As chat grows, the card grows upward, the page grows downward, and the latest message is always visible.</p>
    </div>

    <!-- card lives mid/lower (thanks to .hero gap); it grows upward only -->
    <div class="agent-card" id="agentCard">
      <div class="agent-thread" id="thread"></div>
      <form class="agent-form" id="chatForm" autocomplete="off">
        <input id="chatInput" type="text" placeholder="Type a message…">
        <button type="submit">Send</button>
      </form>
    </div>
  </section>

  <div class="below">
    <p>Extra page content</p>
  </div>

<script>
  const card   = document.getElementById('agentCard');
  const thread = document.getElementById('thread');
  const form   = document.getElementById('chatForm');
  const input  = document.getElementById('chatInput');

  // 1) Always show newest message inside the thread
  function scrollThreadToBottom(){
    thread.scrollTop = thread.scrollHeight - thread.clientHeight;
  }

  // 2) Keep the card's bottom at the viewport bottom by scrolling the PAGE
  //    (only if the card's bottom is below the viewport bottom)
  function alignCardBottomToViewport(){
    const rect = card.getBoundingClientRect();
    const delta = rect.bottom - window.innerHeight;
    if (delta > 0){
      window.scrollBy({ top: delta, behavior: 'instant' in window ? 'instant' : 'smooth' });
    }
  }

  // Append a message and maintain visibility
  function addMessage(text, fromUser=false){
    const bubble = document.createElement('div');
    bubble.className = 'msg' + (fromUser ? ' user' : '');
    bubble.textContent = text;
    thread.appendChild(bubble);

    // After layout paints: ensure newest visible and card bottom aligned
    requestAnimationFrame(() => {
      scrollThreadToBottom();
      alignCardBottomToViewport();
    });
  }

  form.addEventListener('submit', (e)=>{
    e.preventDefault();
    const val = input.value.trim();
    if(!val) return;
    addMessage(val, true);
    input.value = '';
    setTimeout(()=> addMessage("Bot reply to: " + val), 400);
  });

  // Also correct alignment if window size changes
  window.addEventListener('resize', () => {
    requestAnimationFrame(() => {
      scrollThreadToBottom();
      alignCardBottomToViewport();
    });
  });
</script>
</body>
</html>
