<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Overlay Line Scrollbar + Input</title>
<style>
  :root{
    --track-opacity: 0.15;    /* lighter line */
    --thumb-opacity: 0.80;    /* darker moving segment */
    --line-thickness: 3px;    /* line thickness */
    --line-offset: 8px;       /* inset from right edge */
    --line-color: 0,0,0;      /* RGB (no alpha) */
    --thumb-radius: 999px;    /* fully rounded ends */
  }

  html, body {
    height: 100%;
  }

  body {
    margin: 0;
    display: grid;
    place-items: center;
    background: #f6f6f6;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color: #222;
  }

  /* Outer card */
  .demo-wrap {
    width: 80vw;
    height: 75vh;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.08);
    overflow: hidden;         /* clip overlay nicely */
    position: relative;       /* anchor overlay */
  }

  /* Scrollable area */
  .scroller {
    height: 100%;
    width: 100%;
    overflow: auto;
    box-sizing: border-box;
    padding: 16px 28px 16px 16px;   /* extra right padding to breathe near line */
    -webkit-overflow-scrolling: touch;

    /* Hide native scrollbar but keep scrolling */
    scrollbar-width: none;          /* Firefox */
  }
  .scroller::-webkit-scrollbar {    /* Chrome/Safari/Edge */
    width: 0;
    height: 0;
  }

  /* Sticky input at the top of the scrollable area */
  .composer {
    position: sticky;
    top: 0;
    z-index: 1;
    background: #fff;
    padding: 10px 0 14px;
    border-bottom: 1px solid #eee;
    margin-bottom: 12px;
  }

  .composer input {
    width: 100%;
    box-sizing: border-box;
    font: inherit;
    padding: 10px 12px;
    border: 1px solid #ddd;
    border-radius: 8px;
    outline: none;
  }
  .composer input:focus {
    border-color: #bbb;
  }

  /* Content area */
  .content { display: grid; gap: 10px; }
  .line {
    padding: 10px 12px;
    background: #fafafa;
    border: 1px solid #eee;
    border-radius: 8px;
    word-break: break-word;
  }

  /* ---------- Overlay line scrollbar ---------- */
  .scrollbar-overlay {
    position: absolute;
    inset: 0;
    pointer-events: none;      /* clicks go through */
  }

  .scrollbar-track {
    position: absolute;
    top: 8px;
    bottom: 8px;
    right: var(--line-offset);
    width: var(--line-thickness);
    background: rgba(var(--line-color), var(--track-opacity));
    border-radius: var(--thumb-radius);
    opacity: 0;                /* hidden until overflow */
    transition: opacity .15s ease;
  }

  .scrollbar-thumb {
    position: absolute;
    right: var(--line-offset);
    width: var(--line-thickness);
    background: rgba(var(--line-color), var(--thumb-opacity));
    border-radius: var(--thumb-radius);
    opacity: 0;                /* hidden until overflow */
    transition: opacity .15s ease;
  }

  .overlay-visible .scrollbar-track,
  .overlay-visible .scrollbar-thumb {
    opacity: 1;
  }
</style>
</head>
<body>

<div class="demo-wrap" id="demo">
  <div class="scroller" id="scroller" aria-label="Scrollable content">
    <form class="composer" id="composer" autocomplete="off">
      <input id="lineInput" type="text" placeholder="Type and press Enter to add a lineâ€¦" />
    </form>

    <div id="content" class="content" aria-live="polite">
      <!-- Starter lines -->
      <div class="line">Welcome! Add lines with the input above.</div>
      <div class="line">This overlay scrollbar is just a thin line with a darker moving segment.</div>
      <div class="line">As content grows, the thumb shortens and the track stays the same height.</div>
      <div class="line">Try adding a few lines and scrolling around.</div>
      <div class="line">You can tweak thickness, offset, and colors via CSS variables.</div>
    </div>
  </div>

  <!-- Overlay progress line -->
  <div class="scrollbar-overlay" aria-hidden="true">
    <div class="scrollbar-track"></div>
    <div class="scrollbar-thumb" id="thumb"></div>
  </div>
</div>

<script>
(() => {
  const scroller = document.getElementById('scroller');
  const demoWrap = document.getElementById('demo');
  const content = document.getElementById('content');
  const composer = document.getElementById('composer');
  const input = document.getElementById('lineInput');
  const thumb = document.getElementById('thumb');

  const TRACK_INSET_TOP = 8;    // must match CSS .scrollbar-track top
  const TRACK_INSET_BOTTOM = 8; // must match CSS .scrollbar-track bottom
  const MIN_THUMB = 32;         // min px for usability

  function updateThumb() {
    const scrollHeight = scroller.scrollHeight;
    const clientHeight = scroller.clientHeight;
    const scrollTop = scroller.scrollTop;

    const hasOverflow = scrollHeight > clientHeight + 1;

    // Toggle overlay visibility class on the wrapper
    if (hasOverflow) {
      demoWrap.classList.add('overlay-visible');
      thumb.style.display = 'block';
    } else {
      demoWrap.classList.remove('overlay-visible');
      thumb.style.display = 'none';
      return;
    }

    // Available track height inside the container
    const trackHeight = clientHeight - TRACK_INSET_TOP - TRACK_INSET_BOTTOM;

    // Thumb size proportional to visible fraction
    const visibleFraction = clientHeight / scrollHeight;
    const thumbHeight = Math.max(MIN_THUMB, Math.round(trackHeight * visibleFraction));

    // Thumb position proportional to scroll progress
    const maxScroll = scrollHeight - clientHeight;
    const maxThumbTravel = trackHeight - thumbHeight;
    const scrollFraction = maxScroll > 0 ? scrollTop / maxScroll : 0;
    const thumbTop = TRACK_INSET_TOP + Math.round(maxThumbTravel * scrollFraction);

    thumb.style.height = thumbHeight + 'px';
    thumb.style.top = thumbTop + 'px';
  }

  // rAF throttle
  let raf = null;
  function scheduleUpdate() {
    if (raf) return;
    raf = requestAnimationFrame(() => {
      updateThumb();
      raf = null;
    });
  }

  // Add a line on Enter
  composer.addEventListener('submit', (e) => {
    e.preventDefault();
    const text = input.value.trim();
    if (!text) return;

    const div = document.createElement('div');
    div.className = 'line';
    div.textContent = text;
    content.appendChild(div);

    input.value = '';

    // Optionally auto-scroll to bottom to see the new line
    scroller.scrollTo({ top: scroller.scrollHeight, behavior: 'smooth' });

    // Update overlay after DOM change
    scheduleUpdate();
  });

  // Also capture Enter key in case the browser doesn't submit on Enter for some reason
  input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      // Let 'submit' handler run
      // Prevent newline in some browsers (e.g., if input becomes textarea later)
      e.preventDefault();
      composer.requestSubmit();
    }
  });

  // Keep overlay in sync on scroll/resize
  scroller.addEventListener('scroll', scheduleUpdate, { passive: true });
  window.addEventListener('resize', scheduleUpdate);
  window.addEventListener('load', scheduleUpdate);

  // Observe content height changes (adding/removing lines, images loading, etc.)
  if ('ResizeObserver' in window) {
    const ro = new ResizeObserver(scheduleUpdate);
    ro.observe(content);
  }

  // Initial paint
  scheduleUpdate();
})();
</script>
</body>
</html>
